


<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web Presense Of Barry Steyn - Software Engineer, Entrepreneur">
    <meta name="author" content="Barry Steyn">
    <link rel="shortcut icon" href="theme/img/doctrina-icon.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="theme/img/apple-touch-icon-144-precomposed.png">

    <title>Doctrina - 	Upstart With NodeJS And NVM
</title>

    <!-- Bootstrap Base CSS -->
    <link href="http://web-pages.github.io/test/theme/css/base.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link href="http://web-pages.github.io/test/theme/css/main.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,800|Source+Code+Pro" rel="stylesheet">
</head>

<body id="page-top">
    <!-- Top Nav Bar -->
    <nav id="navbar-top" class="navbar navbar-fixed-top navbar-offset-start " role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand " href="/index.html#page-top">
                    <img alt="brand for doctrina" src="http://web-pages.github.io/test/theme/img/apple-touch-icon-144-precomposed.png" style="float: left; max-height:100%;" />
                    <span style="padding-left: 0.5em;">Doctrina</span>
                </a>
                
                <button type="button" class="navbar-toggle" style="" data-toggle="collapse" data-target="#navigation-menu">
<i class="fa fa-bars"></i>                </button>

            </div>

            <div class="collapse navbar-collapse navbar-right" id="navigation-menu">
                        <div>
                            <ul class="nav navbar-nav">
                                <li><a href="#page-top"><span>Article</span></a></li>    
                                <li><a href="#comments"><span>Comments</span></a></li>    
                                <li><a href="#footer"><span>Connect</span></a></li>    
                            </ul>
                        </div>
            </div>


        </div>
    </nav>
    <!-- End Top Nav Bar -->

    <!-- User Defined Sections -->
	<section class="container-fluid title">
	<div class="row">
		<div class="col-md-12">
			<h1><a href="" rel="bookmark" title="Permalink to Upstart With NodeJS And NVM">	Upstart With NodeJS And NVM
</a></h1>
			<span>
				<a href="http://web-pages.github.io/test/index.html#about"><img src="http://web-pages.github.io/test/theme/img/me.jpg" class="img-rounded"></img></a>
			</span>
		</div>
	</div>
</section>

<section class="content">
	<div class="container">
		<div class="row">
				<div class="col-xs-12 text-center metadata">
					<ul class="center-list">
						<li><b>Published</b>: 12  May  2012</li>
					</ul>
				</div>
		</div>
		<div class="row">
				<div class="col-xs-12 col-md-1 col-md-push-10 text-center">
<div id="share">
	<div>
		<span class="toctitle">Share</span>
	</div>
	<div>
	    <a class="fa-stack fa-lg twitter" href="https://twitter.com/intent/tweet?text=Upstart%20With%20NodeJS%20And%20NVM&url=http%3A//web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html&via=">
	        <i class="fa fa-circle fa-stack-2x"></i>
	        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
	    </a>
	</div>
	<div>
		<a class="fa-stack fa-lg facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3A//web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html">
		    <i class="fa fa-circle fa-stack-2x"></i>
		    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
		</a>
	</div>
	<div>
		<a class="fa-stack fa-lg google-plus" href="https://plus.google.com/share?url=http%3A//web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html">
		    <i class="fa fa-circle fa-stack-2x"></i>
		    <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
		</a>
	</div>
	<div>
	    <a class="fa-stack fa-lg linkedin" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A//web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html&title=Upstart%20With%20NodeJS%20And%20NVM">
	        <i class="fa fa-circle fa-stack-2x"></i>
	        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
	    </a>
	</div>
</div>				</div>				


			<div id="content" class="col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-md-pull-1">
	<p>Yet another very short blog article to help anyone who wants to setup an upstart process that runs a <a href="http://nodejs.org/">NodeJS</a> app under <a href="https://github.com/creationix/nvm">nvm</a>. Unlike the <a href="http://doctrina.org/VirtualEnv-With-Upstart.html">uwsgi setup</a>, there is no specific argument switch to give Node that will make it use nvm environment variables. In fact, since Node is single threaded, there is no special server process that must run in the background to interact with it (unlike <a href="http://projects.unbit.it/uwsgi/">uwsgi</a> that is needed for Python). This means that whatever executes Node must also introduce the environment variables manually. But doesn't that defeat the purpose of <a href="https://github.com/creationix/nvm">nvm</a>? Yes, it does! So lets just use <a href="https://github.com/creationix/nvm">nvm</a> to <em>manually introduce those environment variables</em>.</p>
<p>In order to run a <a href="http://nodejs.org/">Node</a> server in upstart that is under nvm, two things need to be determined:</p>
<ol>
<li>The folder where the node app is defined. Not only is this the path where node will execute your app, but node will also search a folder called <em>node_modules</em> under this path for <em>locally installed libraries</em></li>
<li>The folder where you have installed your <code>nvm.sh</code> script.</li>
</ol>
<p><strong>NOTE</strong>: For what follows, the assumption is that the version of node that will be used for execution is the <a href="https://github.com/creationix/nvm#usage">default version of nvm</a>. This accomplished by using <code>alias</code> with nvm to set <code>default</code> (see previous link).</p>
<h1 id="an-upstart-example">An Upstart Example<a class="headerlink" href="#an-upstart-example" title="Permanent link">&para;</a></h1>
<p>Lets assume the following:</p>
<ul>
<li>Your app is defined in the path <code>"/home/dev/node-script"</code></li>
<li>The <em>nvm.sh</em> script is installed in <code>"/home/dev/nvm/nvm.sh"</code></li>
</ul>
<p>Then an upstart script to start node that will run this script under nvm is as follows:
<script src="https://gist.github.com/4467515.js"></script></p>
<p>The above upstart script is very basic, so you should customize it to suit your needs. Yet it has the essential ingredients. The important bit is the <em>exec</em> command on line 11, which starts a bash shell script with the argument <code>-c</code>. This argument means that any text afterwards will be executed as a command script. The command script passed does two things that are separated by <code>&amp;&amp;</code> (the logical and operator):</p>
<ol>
<li><code>source /home/dev/nvm/nvm.sh</code> - this will execute the <code>nvm.sh</code> shell script that loads/creates all relevant environment variables. By using the <a href="http://ss64.com/bash/period.html">source</a> command, all these variables are put within the current shell that it is running in.</li>
<li><code>exec node app</code> - it is essential that we use <a href="http://ss64.com/bash/exec.html">exec</a> to execute the node app. This will replace the current shell with <code>node app</code> <em>without creating a new process</em>.</li>
</ol>
<p>The result of the above two commands is that the node app is executed within its own process but which has access to all environment variables that results from running the nvm shell script.</p>
			</div>
		</div>
	</div>
</section>

	<section class="content screen-height" id="comments">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<div class="content-border">
						<h2>Comments</h2>
        				<div class="divider-grey"></div>
						<a id="disqus" href="http://web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html#disqus_thread">0 Comments</a>
						<div id="disqus_thread"></div>
					</div>
			    </div>
			</div>
    	</div>
	</section>
    <!-- End Sections -->

    <!-- Connect -->
    <section id="connect" class="text-center title">
        <div class="container">
            <h1>Connect</h1>
            
            <div class="row" style="padding: 1.0em 0;">
                Found anything useful on this site? Drop me a line, I'd love to hear about it.
            </div>
            
            <div class="divider-grey"></div>
            
            <div class="row">
                <div class="col-xs-12 col-md-6 col-md-offset-3">
                    <div>
                        <a class="fa-stack fa-lg x" id="x" tabindex="0">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg twitter" href="https://twitter.com/barrysteyn" target="_blank">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg linkedin" href="https://www.linkedin.com/in/barrysteyn" target="_blank">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg github" href="https://github.com/barrysteyn" target="_blank">
                            <i class="fa fa-github fa-stack-2x"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div id="footer" class="row">
                <div class="col-xs-12">
                    <p>&copy; <script>document.write(new Date().getFullYear());</script> Barry Steyn. All Rights Reserved.
                </div>
            </div>
            <!-- End Footer -->
        </div>
    </section>
    <!-- End Connect -->

    <!-- JavaScript -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
        var scrollspies = {};
        scrollspies.body = {
            'target': '#navigation-menu'
        };

		//Do not remove navbar-offset-start class
	var navbarOffset = false;

	//Scrollspy object
    scrollspies.body = {
        'target': '.toc'
    };


	$(function() {
		var disqus = {
			shortname: 'doctrinalocal',
			identifier: 'http://web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html',
			url: 'http://web-pages.github.io/test/NodeJS-Under-NVM-With-Upstart.html',
			developer: 0
		};

		disqus_comments(disqus);
	});
    </script>
    <script src="http://web-pages.github.io/test/theme/js/main.js"></script>
    <!-- End JavaScript -->
</body>

</html>