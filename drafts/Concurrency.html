


<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web Presense Of Barry Steyn - Software Engineer, Entrepreneur">
    <meta name="author" content="Barry Steyn">
    <link rel="shortcut icon" href="theme/img/doctrina-icon.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="theme/img/apple-touch-icon-144-precomposed.png">

    <title>Doctrina - 	Concurrency
</title>

    <!-- Bootstrap Base CSS -->
    <link href="http://web-pages.github.io/test/theme/css/base.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link href="http://web-pages.github.io/test/theme/css/main.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,800|Source+Code+Pro" rel="stylesheet">
</head>

<body id="page-top">
    <!-- Top Nav Bar -->
    <nav id="navbar-top" class="navbar navbar-fixed-top navbar-offset-start " role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand " href="/index.html#page-top">
                    <img alt="brand for doctrina" src="http://web-pages.github.io/test/theme/img/apple-touch-icon-144-precomposed.png" style="float: left; max-height:100%;" />
                    <span style="padding-left: 0.5em;">Doctrina</span>
                </a>
                
                <button type="button" class="navbar-toggle" style="" data-toggle="collapse" data-target="#navigation-menu">
<i class="fa fa-bars"></i>                </button>

            </div>

            <div class="collapse navbar-collapse navbar-right" id="navigation-menu">
                        <div>
                            <ul class="nav navbar-nav">
                                <li><a href="#page-top"><span>Article</span></a></li>    
                                <li><a href="#comments"><span>Comments</span></a></li>    
                                <li><a href="#footer"><span>Connect</span></a></li>    
                            </ul>
                        </div>
            </div>


        </div>
    </nav>
    <!-- End Top Nav Bar -->

    <!-- User Defined Sections -->
	<section class="container-fluid title">
	<div class="row">
		<div class="col-md-12">
			<h1><a href="" rel="bookmark" title="Permalink to Concurrency">	Concurrency
</a></h1>
			<span>
				<a href="http://web-pages.github.io/test/index.html#about"><img src="http://web-pages.github.io/test/theme/img/me.jpg" class="img-rounded"></img></a>
			</span>
		</div>
	</div>
</section>

<section class="content">
	<div class="container">
		<div class="row">
				<div class="col-xs-12 text-center metadata">
					<ul class="center-list">
						<li><b>Published</b>: 22  Apr  2013</li>
					</ul>
				</div>
		</div>
		<div class="row">
				<div class="col-xs-12 col-md-1 col-md-push-10 text-center">
<div id="share">
	<div>
		<span class="toctitle">Share</span>
	</div>
	<div>
	    <a class="fa-stack fa-lg twitter" href="https://twitter.com/intent/tweet?text=Concurrency&url=http%3A//web-pages.github.io/test/drafts/Concurrency.html&via=">
	        <i class="fa fa-circle fa-stack-2x"></i>
	        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
	    </a>
	</div>
	<div>
		<a class="fa-stack fa-lg facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3A//web-pages.github.io/test/drafts/Concurrency.html">
		    <i class="fa fa-circle fa-stack-2x"></i>
		    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
		</a>
	</div>
	<div>
		<a class="fa-stack fa-lg google-plus" href="https://plus.google.com/share?url=http%3A//web-pages.github.io/test/drafts/Concurrency.html">
		    <i class="fa fa-circle fa-stack-2x"></i>
		    <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
		</a>
	</div>
	<div>
	    <a class="fa-stack fa-lg linkedin" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A//web-pages.github.io/test/drafts/Concurrency.html&title=Concurrency">
	        <i class="fa fa-circle fa-stack-2x"></i>
	        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
	    </a>
	</div>
</div>				</div>				


			<div id="content" class="col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-md-pull-1">
	<p>Concurrency is very prone to error if not done correctly. Even things like AJAX, which do things asynchronously, may need to access data from other parts of a program.</p>
<h1 id="threads">Threads<a class="headerlink" href="#threads" title="Permanent link">&para;</a></h1>
<ul>
<li>Is a fundamental unit of execution.</li>
<li>Every program has at least one thread running.</li>
<li>Each thread has its own stack and runs independently.</li>
<li>Threads share memory and data &lt;= <strong>*This is where the danger comes in</strong></li>
</ul>
<h2 id="access-to-shared-data-needs-to-be-controlled">Access To Shared Data Needs To Be Controlled<a class="headerlink" href="#access-to-shared-data-needs-to-be-controlled" title="Permanent link">&para;</a></h2>
<p>A common side effect is data corruption.</p>
<h3 id="monitors-and-semaphores">Monitors And Semaphores<a class="headerlink" href="#monitors-and-semaphores" title="Permanent link">&para;</a></h3>
<p>Monitors and semaphores are <em>thread synchronization</em> mechanisms.</p>
<p><strong>Monitor</strong> - a set of routines protected by a mutual exclusion lock. A thread must wait to execute routines in a monitor - meaning only one thread at a time can execute in a monitor. A thread can suspend itself in a monitor, thus giving up its lock.</p>
<p><strong>Semaphore</strong> - more simple than a monitor: It is just a lock that protects shared resources. Examples are a <em>mutex</em>.</p>
<p>Monitors are much simpler to use because the sparse nature of semaphores. For example, using semaphores requires each thread to carefully release its thread (including in conditions where the thread ends unexpectedly) otherwise no other thread that needs the shared resources can begin. It also requires them to manage acquiring of locks. Monitors on the other hand handle this all automatically. </p>
<h3 id="deadlocks">Deadlocks<a class="headerlink" href="#deadlocks" title="Permanent link">&para;</a></h3>
<p>This situation occurs when two threads block each other. For instance, two threads, A and B, are each waiting for a lock that the other has acquired. There is no suitable conflict resolution that is known. Some ideas are to always acquire locks in the same order, and release them in reverse order. </p>
<h2 id="nativekernel-level-threads-vs-green-threads-vs-user-threads">Native/Kernel-level Threads Vs Green Threads Vs User Threads<a class="headerlink" href="#nativekernel-level-threads-vs-green-threads-vs-user-threads" title="Permanent link">&para;</a></h2>
<p>Native threads are started and managed by the Kernel. Green threads are started by a software layer above the kernel (e.g. a virtual machine). Green threads cannot take advantage of multi-core processors, and therefore there is a shift away from them.</p>
<p>Key concepts:</p>
<ul>
<li><strong>Native Threads</strong></li>
<li><strong>Green Threads</strong>  </li>
</ul>
<h2 id="system-threads-vs-user-threads">System Threads Vs User Threads<a class="headerlink" href="#system-threads-vs-user-threads" title="Permanent link">&para;</a></h2>
<p>System threads are created by the <strong>system</strong> (OS). For instance, the first thread that is created when a program starts. The program often exits when this thread terminates.</p>
<p>User threads are created by an user application to perform tasks that should not be performed by the main thread. For example, the event loop is a user thread.</p>
<h2 id="preemptive-threading">Preemptive Threading<a class="headerlink" href="#preemptive-threading" title="Permanent link">&para;</a></h2>
<p>Due to finite resources, only a certain amount of threads can run concurrently any one time. The OS therefore gives each thread a window of execution time, after which it switches to another thread. It accomplishes this by pausing the current thread's execution and then switching to the new thread. This is <strong>preemptive threading</strong>.</p>
<p>Key concepts:</p>
<ul>
<li><strong>preemptive threading</strong> - </li>
<li><strong>context switch</strong> - the pausing and saving of thread state in order to switch to another thread.</li>
<li><strong>cooperative model</strong> - the opposite of preemptive threading, where a thread will inform other threads when not busy so they can run</li>
</ul>
<h1 id="threading-examples-in-java">Threading Examples In Java<a class="headerlink" href="#threading-examples-in-java" title="Permanent link">&para;</a></h1>
<p>In Java, use the <code>synchronized</code> keyword to make a monitor around routines.</p>
<h1 id="common-synchronization-problems">Common Synchronization Problems<a class="headerlink" href="#common-synchronization-problems" title="Permanent link">&para;</a></h1>
<h2 id="busy-waiting">Busy Waiting<a class="headerlink" href="#busy-waiting" title="Permanent link">&para;</a></h2>
<p>Busy waiting is when a thread is waiting for another thread to complete. The first thread is performing this wait by continually polling to see if the other thread is alive. Even though the waiting thread is not doing any work, because it is not sleeping, it is stealing resources.</p>
<p>Here is a simple example of <em>busy wait</em>:</p>
<div class="highlight"><pre><span class="n">Thread</span> <span class="n">task</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TheTask</span><span class="p">();</span>
<span class="n">task</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">isAlive</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// do nothing</span>
<span class="p">}</span>
</pre></div>


<p>This can be avoided by using a monitor or a semaphore</p>
<div class="highlight"><pre><span class="n">class</span> <span class="n">TheTask</span> <span class="n">extends</span> <span class="n">Thread</span> <span class="p">{</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">synchronized</span><span class="p">(</span><span class="n">this</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//do something</span>

            <span class="n">this</span><span class="p">.</span><span class="n">notify</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Thread</span> <span class="n">task</span> <span class="o">=</span> <span class="n">new</span> <span class="n">TheTask</span><span class="p">();</span>
<span class="n">synchronized</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">task</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">task</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">interruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//do something if interrupted</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="producerconsumer">Producer/Consumer<a class="headerlink" href="#producerconsumer" title="Permanent link">&para;</a></h2>
<p>This is a classic problem! The problem is to write a producer and consumer thread, where the producer produces numbers and the consumer consumes them.</p>
<div class="highlight"><pre><span class="n">class</span> <span class="n">BufferInt</span> <span class="p">{</span>
    <span class="n">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="n">public</span> <span class="nf">BufferInt</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">synchronized</span> <span class="n">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">buffer</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">try</span> <span class="p">{</span>
                <span class="n">wait</span><span class="p">();</span>
            <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">buffer</span><span class="p">[</span><span class="n">size</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">;</span>

        <span class="n">notifyAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">synchronized</span> <span class="n">public</span> <span class="kt">int</span> <span class="nf">remove</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">size</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">try</span> <span class="p">{</span>
                <span class="n">wait</span><span class="p">();</span>
            <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="o">--</span><span class="n">size</span><span class="p">];</span>
        <span class="n">notifyAll</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">Consume</span> <span class="n">extends</span> <span class="n">Thread</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">BufferInt</span> <span class="n">bint</span><span class="p">;</span>

    <span class="n">public</span> <span class="nf">Consume</span><span class="p">(</span><span class="n">BufferInt</span> <span class="n">bint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="p">.</span><span class="n">bint</span> <span class="o">=</span> <span class="n">bint</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">Produce</span> <span class="n">extends</span> <span class="n">Thread</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">BufferInt</span> <span class="n">bint</span><span class="p">;</span>

    <span class="n">public</span> <span class="nf">Produce</span><span class="p">(</span><span class="n">BufferInt</span> <span class="n">bint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="p">.</span><span class="n">bint</span> <span class="o">=</span> <span class="n">bint</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
			</div>
		</div>
	</div>
</section>

	<section class="content screen-height" id="comments">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<div class="content-border">
						<h2>Comments</h2>
        				<div class="divider-grey"></div>
						<a id="disqus" href="http://web-pages.github.io/test/drafts/Concurrency.html#disqus_thread">0 Comments</a>
						<div id="disqus_thread"></div>
					</div>
			    </div>
			</div>
    	</div>
	</section>
    <!-- End Sections -->

    <!-- Connect -->
    <section id="connect" class="text-center title">
        <div class="container">
            <h1>Connect</h1>
            
            <div class="row" style="padding: 1.0em 0;">
                Found anything useful on this site? Drop me a line, I'd love to hear about it.
            </div>
            
            <div class="divider-grey"></div>
            
            <div class="row">
                <div class="col-xs-12 col-md-6 col-md-offset-3">
                    <div>
                        <a class="fa-stack fa-lg x" id="x" tabindex="0">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg twitter" href="https://twitter.com/barrysteyn" target="_blank">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg linkedin" href="https://www.linkedin.com/in/barrysteyn" target="_blank">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                        </a>
                        <a class="fa-stack fa-lg github" href="https://github.com/barrysteyn" target="_blank">
                            <i class="fa fa-github fa-stack-2x"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div id="footer" class="row">
                <div class="col-xs-12">
                    <p>&copy; <script>document.write(new Date().getFullYear());</script> Barry Steyn. All Rights Reserved.
                </div>
            </div>
            <!-- End Footer -->
        </div>
    </section>
    <!-- End Connect -->

    <!-- JavaScript -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
        var scrollspies = {};
        scrollspies.body = {
            'target': '#navigation-menu'
        };

		//Do not remove navbar-offset-start class
	var navbarOffset = false;

	//Scrollspy object
    scrollspies.body = {
        'target': '.toc'
    };


	$(function() {
		var disqus = {
			shortname: 'doctrinalocal',
			identifier: 'http://web-pages.github.io/test/drafts/Concurrency.html',
			url: 'http://web-pages.github.io/test/drafts/Concurrency.html',
			developer: 0
		};

		disqus_comments(disqus);
	});
    </script>
    <script src="http://web-pages.github.io/test/theme/js/main.js"></script>
    <!-- End JavaScript -->
</body>

</html>